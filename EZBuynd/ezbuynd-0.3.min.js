(function(n){n.EZB=function(){var v=function(n,t){console.log("Missing property "+t+" on object:",n)},i={text:function(n,t){_.isUndefined(n.textContent)?n.innerText=t:n.textContent=t},html:function(n,t){n.innerHTML=t},value:function(n,t){n.setAttribute("value",t)}},n={attributePrefix:"ezb-",valueArgSeperator:"|",propertyBinder:".",restoreOptionsKey:"__ezbRestoreOptions",rootSetFunctionName:"__setRoot",watchersPropName:"__ezbWatchers",arrayTemplates:"__ezbArrayTemplates",arrayDependency:"__ezbArrayDependency"},c=function(t){var u=t.attributes,i={attributes:[],hasEach:!1,hasIgnore:!1,hasAny:!1,isValidElement:!1},r;if(_.isUndefined(u))return i;for(i.isValidElement=!0,r=0;r<u.length;r++)if(u[r].name.indexOf(n.attributePrefix)===0){var f=u[r].name.split("-"),e=f[1],s=f.length>2?f.slice(2):[],o=u[r].value.split(n.valueArgSeperator),h=o[0],arguments=o.length>1?o.slice(1):[];i.attributes.push({fullname:u[r].name,fullvalue:u[r].value,attributeArgs:s,value:h,valueArgs:arguments,type:e});e==="ignore"?i.hasIgnore=!0:e==="each"&&(i.hasEach=!0)}return i.attributes.length>0&&(i.hasAny=!0),i},y=function(n){for(var t=0;t<n.attributes.length;t++)if(n.attributes[t].type==="each")return n.attributes[t];return},r=function(n,t){for(var u=n.attributes,f=document.createElement(n.tagName),i=0;i<u.length;i++)if(u[i].name==="id")continue;else f.setAttribute(u[i].name,u[i].value);if(t)for(i=0;i<n.children.length;i++)f.appendChild(r(n.children[i],!0));return f},e=function(n){for(var o,f,t={sourceElement:n,childTemplates:[],baseElement:null,valueBindings:[],dependencyKey:null},i=r(n,!0),u=0;u<i.children.length;u++)if(o=c(i.children[u]),o.hasIgnore)continue;else o.hasEach?(f=e(i.children[u]),f.parentTemplate=t,t.childTemplates.push(f),i.removeChild(i.children[u]),u--):(f=e(i.children[u]),f.parentTemplate=t,t.childTemplates.push(f));return t.appendNew=function(n){var i=t.parentTemplate,u,r,e,f;if(_.isUndefined(i)){v(i,"parentTemplate");throw"No parent template was found.";}if(i.childTemplates.length>1){for(u=-1,r=0;r<i.childTemplates.length;r++)if(t===i.childTemplates[r]){u=r;break}r===i.childTemplates.length-1?t.parentEl.appendChild(n):(e=i.childTemplates[u+1],f=e.el,_.isUndefined(f)||t.parentEl.insertBefore(n,f))}else t.parentEl.appendChild(n)},t.baseElement=i,t},o=function(n,t){var i,r;if(n.key===t)return n;for(i=0;i<n.subkeys.length;i++){if(n.subkeys[i].key===t)return n.subkeys[i];if(r=o(n.subkeys[i],t),!_.isUndefined(r))return r}return},l=function(t,i){var s=c(i.baseElement),f,v,b,p,h,a,u,e,w,k,r;if(s.hasIgnore)return i;for(s.hasEach&&(f=y(s),v=f.value.split(n.propertyBinder),v.length===1||_.isNull(t)?i.dependencyKey={rootKey:undefined,parent:undefined,key:f.attributeArgs[0],value:f.value,subkeys:[]}:(b=t.rootKey||t,p=o(b,v[0]),_.isUndefined(p)?(h={rootKey:undefined,parent:undefined,key:f.attributeArgs[0],value:f.value,subkeys:[]},i.dependencyKey=h):(h={parent:p,rootKey:b,subkeys:[],value:v.slice(1).join(n.propertyBinder),key:f.attributeArgs[0]},p.subkeys.push(h),i.dependencyKey=h))),_.isNull(i.dependencyKey)?_.isNull(t)||(a=t.rootKey||t||null):a=i.dependencyKey.rootKey||i.dependencyKey,r=0;r<s.attributes.length;r++)if(u=s.attributes[r],u.type==="each"||u.type==="ignore")continue;else{for(e={type:u.type,dependency:null,value:u.value},r=0;r<u.valueArgs.length;r++)u.valueArgs[r]==="nowatch"?e.nowatch=!0:u.valueArgs[r]==="logchange"&&(e.logchange=!0);w=u.value.split(n.propertyBinder);w.length>1&&(_.isUndefined(a)||(k=o(a,w[0]),_.isUndefined(k)||(e.value=w.slice(1).join(n.propertyBinder),e.dependency=k)));i.valueBindings.push(e)}for(r=0;r<i.childTemplates.length;r++)i.childTemplates[r]=l(a||null,i.childTemplates[r]);return i},t=function(t,i){for(var f=i.split(n.propertyBinder),r=t,u=0;u<f.length;u++)if(_.isUndefined(r)){console.log("Missing property",r);throw'The property "'+f[u]+'" does not exist on object';}else r=h(r,f[u]);return r},s=function(n,t){var i=n.keys[t];if(_.isUndefined(i)){console.log(n);throw"No data key could be found in the binding source for ["+t+"]";}return i},h=function(n,t){return _.isUndefined(n.get)?n[t]:n.get(t)},u=function(t,r,u,f,e){var s=t.split(n.propertyBinder),c,l,v,o,y;if(s.length>1)for(o=0;o<s.length-1;o++)u=h(u,s[o]);for(c=s[s.length-1],l=r.logchange?function(){var n=h(u,t);console.log("Object changed",u);console.log('Value of "'+c+'" has been changed to: ',n);i[r.type](f,n)}:function(){i[r.type](f,u.get(t))},v=!1,_.isUndefined(u[n.watchersPropName])&&(u[n.watchersPropName]=[]),o=0;o<u[n.watchersPropName].length;o++)if(c===u[n.watchersPropName][o].key&&u[n.watchersPropName][o].binding==e){v=!0;u[n.watchersPropName][o].watchers.push(l);break}v||(y={key:c,watchers:[l],binding:e},u[n.watchersPropName].push(y));_.isUndefined(u[n.restoreOptionsKey])&&a(u);_.isUndefined(u[n.rootSetFunctionName])&&(u[n.rootSetFunctionName]=u[n.restoreOptionsKey].objectOptions.hasSetter?u.set:function(n){return function(t,i){n[t]=i}}(u),u.set=function(t){return function(i,r){var e,u,f;for(t[n.rootSetFunctionName](i,r),u=0;u<t[n.watchersPropName].length;u++)if(i===t[n.watchersPropName][u].key)for(e=t[n.watchersPropName][u].watchers,f=0;f<e.length;f++)e[f]()}}(u));u[n.restoreOptionsKey].objectOptions.hasGetter||(u.get=function(n){return function(t){return n[t]}}(u))},p=function(t,i,r){var u={binding:r,template:t};return _.isUndefined(i[n.arrayTemplates])?i[n.arrayTemplates]=[u]:i[n.arrayTemplates].push(u),u},w=function(t){if(_.isUndefined(t[n.restoreOptionsKey])){var i={isArray:!0,arrayOptions:{push:t.push,pop:t.pop,reverse:t.reverse,shift:t.shift,sort:t.sort,splice:t.splice,unshift:t.unshift}};t[n.restoreOptionsKey]=i;t.push=function(){for(var o,u,e,f,s,i=[],r=0;r<arguments.length-0;r++)i[r]=arguments[r+0];if(i.length===0)return t.length;for(o=t[n.restoreOptionsKey].arrayOptions.push.apply(t,i),u=0;u<t[n.arrayTemplates].length;u++)for(e=t[n.arrayTemplates][u],f=0;f<i.length;f++)s=e.creator(i[f]),e.template.appendNew(s);return o}}},b=function(f,e,o){var y,h;o.datasource=f;var a=o.els,c=o.rootTemplate,l=r(c.baseElement,!1);for(o.rootTemplate.sourceElement.hasAttribute("id")&&l.setAttribute("id",o.rootTemplate.sourceElement.getAttribute("id")),h=0;h<c.valueBindings.length;h++)y=t(o.datasource,c.valueBindings[h].value),i[c.valueBindings[h].type](l,y);var k={keys:{},root:f},v=function(f,e,h){for(var d,nt,g,ut,k,c,it,b,rt,l,tt=[],y=f.childTemplates,a=0;a<y.length;a++)if(_.isNull(y[a].dependencyKey)){for(k=r(y[a].baseElement,!1),l=0;l<y[a].valueBindings.length;l++)c=y[a].valueBindings[l],_.isNull(c.dependency)?(b=t(h.root,c.value),c.nowatch||u(c.value,c,h.root,k,o)):(it=s(h,c.dependency.key),b=t(it,c.value),c.nowatch||u(c.value,c,it,k,o)),i[c.type](k,b),k.removeAttribute(n.attributePrefix+c.type);for(rt=v(y[a],k,h),l=0;l<rt.length;l++)k.appendChild(rt[l]);y[a].el=k;tt.push(k)}else{if(d=y[a].dependencyKey,b=_.isUndefined(d.parent)?t(h.root,d.value):t(s(h,d.parent.key),d.value),_.isUndefined(b)){console.log(h,y[a]);continue}for(w(b,o),nt=p(y[a],b,o),g=nt.template,nt.creator=function(f){var l,y,a,c,p;for(h.keys[d.key]=f,l=r(g.baseElement,!1),l.removeAttribute(n.attributePrefix+"each-"+d.key),y=v(g,l,h),a=0;a<y.length;a++)l.appendChild(y[a]);for(a=0;a<g.valueBindings.length;a++)c=g.valueBindings[a],_.isNull(c.dependency)?(p=t(h.root,c.value),c.nowatch||u(c.value,c,h.root,l,o)):(p=t(s(h,c.dependency.key),c.value),c.nowatch||u(c.value,c,h.root,l,o)),i[c.type](l,p),l.removeAttribute(n.attributePrefix+c.type);return g.parentEl=e,l},l=0;l<b.length;l++)ut=nt.creator(b[l]),tt.push(ut)}return tt},b=v(c,l,k);for(h=0;h<b.length;h++)l.appendChild(b[h]);o.els=l;document.body.contains(e)?e.parentNode.replaceChild(o.els,e):document.body.contains(a)&&a.parentNode.replaceChild(o.els,a)},f=function(t,i,r){var o,v,s,c,u,l,h,a,e;if(!_.isUndefined(t)){if(!_.isUndefined(t[n.watchersPropName])){for(o=0;o<t[n.watchersPropName].length;o++)v=t[n.watchersPropName][o],v.binding==r&&(t[n.watchersPropName].splice(o,1),o--);t[n.watchersPropName].length===0&&delete t[n.watchersPropName]}s=t[n.restoreOptionsKey];!_.isUndefined(s)&&_.isUndefined(t[n.watchersPropName])&&(s.objectOptions.hasSetter?t.set==t[n.rootSetFunctionName]:delete t.set,s.objectOptions.hasGetter||delete t.get,delete t[n.rootSetFunctionName],delete t[n.restoreOptionsKey]);c=[n.restoreOptionsKey,n.rootSetFunctionName,n.watchersPropName,"set","get"];for(u in t){for(l=!1,h=0;h<c.length;h++)if(c[h]===u){l=!0;break}if(!l&&Object.prototype.hasOwnProperty.call(t,u)){if(_.isFunction(t[u])||!_.isObject(t[u])||_.isNull(t[u])||_.isUndefined(t[u]))continue;if(_.isNull(i))i=[t];else{for(a=!1,e=0;e<i.length;e++)if(i[e]==t[u]){a=!0;break}if(a)continue;i.push(t)}if(_.isArray(t[u]))for(t.unbound.push(t[u]),e=0;e<t[u].length;e++)f(t[u][e],i,r);else f(t[u],i,r)}}}},a=function(t){_.isUndefined(t[n.restoreOptionsKey])&&(t[n.restoreOptionsKey]={isArray:!1,objectOptions:{hasSetter:!_.isUndefined(t.set),hasGetter:!_.isUndefined(t.get)}})},k=function(n,t){var i={_backup:n,rootTemplate:e(n)};return a(t),i.rootTemplate=l(i.rootTemplate.dependencyKey,i.rootTemplate),i.setDataSource=function(n,t){return function(i){f(n.datasource,null,n);b(i,t,n)}}(i,n),i.setDataSource(t),i.unbind=function(n){return function(t){f(n.datasource,null,n);_.isUndefined(t)||(t==="remove"?n.els.parentNode.removeChild(n.els):t==="reset"&&n.els.parentNode.replaceChild(n._backup,n.els))}}(i),i};return{options:n,bind:k,binders:i}}()})(this);
/*
//# sourceMappingURL=ezbuynd-0.3.min.js.map
*/