(function(n){n.EZB=function(){var i={text:function(n,t){_.isUndefined(n.textContent)?n.innerText=t:n.textContent=t},html:function(n,t){n.innerHTML=t},value:function(n,t){n.setAttribute("value",t)}},n={attributePrefix:"ezb-",valueArgSeperator:"|",propertyBinder:".",restoreOptionsKey:"__ezbRestoreOptions",rootSetFunctionName:"__setRoot",watchersPropName:"__ezbWatchers"},h=function(t){var u=t.attributes,i={attributes:[],hasEach:!1,hasIgnore:!1,hasAny:!1,isValidElement:!1},r;if(_.isUndefined(u))return i;for(i.isValidElement=!0,r=0;r<u.length;r++)if(u[r].name.indexOf(n.attributePrefix)===0){var f=u[r].name.split("-"),e=f[1],s=f.length>2?f.slice(2):[],o=u[r].value.split(n.valueArgSeperator),h=o[0],arguments=o.length>1?o.slice(1):[];i.attributes.push({fullname:u[r].name,fullvalue:u[r].value,attributeArgs:s,value:h,valueArgs:arguments,type:e});e==="ignore"?i.hasIgnore=!0:e==="each"&&(i.hasEach=!0)}return i.attributes.length>0&&(i.hasAny=!0),i},v=function(n){for(var t=0;t<n.attributes.length;t++)if(n.attributes[t].type==="each")return n.attributes[t];return},r=function(n,t){for(var u=n.attributes,f=document.createElement(n.tagName),i=0;i<u.length;i++)if(u[i].name==="id")continue;else f.setAttribute(u[i].name,u[i].value);if(t)for(i=0;i<n.children.length;i++)f.appendChild(r(n.children[i],!0));return f},e=function(n){for(var f,u={sourceElement:n,childTemplates:[],baseElement:null,valueBindings:[],dependencyKey:null},t=r(n,!0),i=0;i<n.children.length;i++)if(f=h(t.children[i]),f.hasIgnore)continue;else f.hasEach?(u.childTemplates.push(e(t.children[i])),t.removeChild(t.children[i])):u.childTemplates.push(e(t.children[i]));return u.baseElement=t,u},o=function(n,t){var i,r;if(n.key===t)return n;for(i=0;i<n.subkeys.length;i++){if(n.subkeys[i].key===t)return n.subkeys[i];if(r=o(n.subkeys[i],t),!_.isUndefined(r))return r}return},c=function(t,i){var s=h(i.baseElement),f,y,b,p,l,a,u,e,w,k,r;if(s.hasIgnore)return i;for(s.hasEach&&(f=v(s),y=f.value.split(n.propertyBinder),y.length===1||_.isNull(t)?i.dependencyKey={rootKey:undefined,parent:undefined,key:f.attributeArgs[0],value:f.value,subkeys:[]}:(b=t.rootKey||t,p=o(b,y[0]),_.isUndefined(p)?(l={rootKey:undefined,parent:undefined,key:f.attributeArgs[0],value:f.value,subkeys:[]},i.dependencyKey=l):(l={parent:p,rootKey:b,subkeys:[],value:y.slice(1).join(n.propertyBinder),key:f.attributeArgs[0]},p.subkeys.push(l),i.dependencyKey=l))),_.isNull(i.dependencyKey)?_.isNull(t)||(a=t.rootKey||t||null):a=i.dependencyKey.rootKey||i.dependencyKey,r=0;r<s.attributes.length;r++)if(u=s.attributes[r],u.type==="each"||u.type==="ignore")continue;else{for(e={type:u.type,dependency:null,value:u.value},r=0;r<u.valueArgs.length;r++)u.valueArgs[r]==="nowatch"?e.nowatch=!0:u.valueArgs[r]==="logchange"&&(e.logchange=!0);w=u.value.split(n.propertyBinder);w.length>1&&(_.isUndefined(a)||(k=o(a,w[0]),_.isUndefined(k)||(e.value=w.slice(1).join(n.propertyBinder),e.dependency=k)));i.valueBindings.push(e)}for(r=0;r<i.childTemplates.length;r++)i.childTemplates[r]=c(a||null,i.childTemplates[r]);return i},t=function(t,i){for(var f=i.split(n.propertyBinder),r=t,u=0;u<f.length;u++)r=_.isUndefined(r.get)?r[f[u]]:r.get(f[u]);return r},s=function(n,t){var i=n.keys[t];if(_.isUndefined(i)){console.log(n);throw"No data key could be found in the binding source for ["+t+"]";}return i},l=function(n,t){return _.isUndefined(n.get)?n[t]:n.get(t)},u=function(t,r,u,f,e){var s=t.split(n.propertyBinder),h,c,v,o,y;if(s.length>1)for(o=0;o<s.length-1;o++)u=l(u,s[o]);for(h=s[s.length-1],c=r.logchange?function(){var n=l(u,t);console.log("Object changed",u);console.log('Value of "'+h+'" has been changed to: ',n);i[r.type](f,n)}:function(){i[r.type](f,u.get(t))},v=!1,_.isUndefined(u[n.watchersPropName])&&(u[n.watchersPropName]=[]),o=0;o<u[n.watchersPropName].length;o++)if(h===u[n.watchersPropName][o].key&&u[n.watchersPropName][o].binding==e){v=!0;u[n.watchersPropName][o].watchers.push(c);break}v||(y={key:h,watchers:[c],binding:e},u[n.watchersPropName].push(y));_.isUndefined(u[n.restoreOptionsKey])&&a(u,e);_.isUndefined(u[n.rootSetFunctionName])&&(u[n.rootSetFunctionName]=u[n.restoreOptionsKey].hasSetter?u.set:function(n){return function(t,i){n[t]=i}}(u),u.set=function(t){return function(i,r){var e,u,f;for(t[n.rootSetFunctionName](i,r),u=0;u<t[n.watchersPropName].length;u++)if(i===t[n.watchersPropName][u].key)for(e=t[n.watchersPropName][u].watchers,f=0;f<e.length;f++)e[f]()}}(u));u[n.restoreOptionsKey].hasGetter||(u.get=function(n){return function(t){return n[t]}}(u))},y=function(f,e,o){var y,h;o.datasource=f;var a=o.els,c=o.rootTemplate,l=r(c.baseElement,!1);for(o.rootTemplate.sourceElement.hasAttribute("id")&&l.setAttribute("id",o.rootTemplate.sourceElement.getAttribute("id")),h=0;h<c.valueBindings.length;h++)y=t(o.datasource,c.valueBindings[h].value),i[c.valueBindings[h].type](l,y);var w={keys:{},root:f},v=function(f,e){for(var w,y,d,p,nt,k,h,tt,b,a,g=[],l=f.childTemplates,c=0;c<l.length;c++)if(_.isNull(l[c].dependencyKey)){for(k=r(l[c].baseElement,!1),a=0;a<l[c].valueBindings.length;a++)h=l[c].valueBindings[a],_.isNull(h.dependency)?(b=t(e.root,h.value),h.nowatch||u(h.value,h,e.root,k,o)):(tt=s(e,h.dependency.key),b=t(tt,h.value),h.nowatch||u(h.value,h,tt,k,o)),i[h.type](k,b),k.removeAttribute(n.attributePrefix+h.type);for(d=v(l[c],e),a=0;a<d.length;a++)k.appendChild(d[a]);g.push(k)}else for(w=l[c].dependencyKey,b=_.isUndefined(w.parent)?t(e.root,w.value):t(s(e,w.parent.key),w.value),_.isUndefined(b)&&console.log(e,l[c]),a=0;a<b.length;a++){for(e.keys[w.key]=b[a],y=r(l[c].baseElement,!1),y.removeAttribute(n.attributePrefix+"each-"+w.key),d=v(l[c],e),p=0;p<d.length;p++)y.appendChild(d[p]);for(p=0;p<l[c].valueBindings.length;p++)h=l[c].valueBindings[p],_.isNull(h.dependency)?(nt=t(e.root,h.value),h.nowatch||u(h.value,h,e.root,y,o)):(nt=t(s(e,h.dependency.key),h.value),h.nowatch||u(h.value,h,e.root,y,o)),i[h.type](y,nt),y.removeAttribute(n.attributePrefix+h.type);g.push(y)}return g},p=v(c,w);for(h=0;h<p.length;h++)l.appendChild(p[h]);o.els=l;document.body.contains(e)?e.parentNode.replaceChild(o.els,e):document.body.contains(a)&&a.parentNode.replaceChild(o.els,a)},f=function(t,i,r){var o,v,s,c,u,l,h,a,e;if(!_.isUndefined(t)){if(!_.isUndefined(t[n.watchersPropName])){for(o=0;o<t[n.watchersPropName].length;o++)v=t[n.watchersPropName][o],v.binding==r&&(t[n.watchersPropName].splice(o,1),o--);t[n.watchersPropName].length===0&&delete t[n.watchersPropName]}s=t[n.restoreOptionsKey];!_.isUndefined(s)&&_.isUndefined(t[n.watchersPropName])&&(s.hasSetter?t.set==t[n.rootSetFunctionName]:delete t.set,s.hasGetter||delete t.get,delete t[n.rootSetFunctionName],delete t[n.restoreOptionsKey]);c=[n.restoreOptionsKey,n.rootSetFunctionName,n.watchersPropName,"set","get"];for(u in t){for(l=!1,h=0;h<c.length;h++)if(c[h]===u){l=!0;break}if(!l&&Object.prototype.hasOwnProperty.call(t,u)){if(_.isFunction(t[u])||!_.isObject(t[u])||_.isNull(t[u])||_.isUndefined(t[u]))continue;if(_.isNull(i))i=[t];else{for(a=!1,e=0;e<i.length;e++)if(i[e]==t[u]){a=!0;break}if(a)continue;i.push(t)}if(_.isArray(t[u]))for(i.push(t[u]),e=0;e<t[u].length;e++)f(t[u][e],i,r);else f(t[u],i,r)}}}},a=function(t){_.isUndefined(t[n.restoreOptionsKey])&&(t[n.restoreOptionsKey]={hasSetter:!_.isUndefined(t.set),hasGetter:!_.isUndefined(t.get)})},p=function(n,t){var i={_backup:n,rootTemplate:e(n)};return a(t,i),i.rootTemplate=c(i.rootTemplate.dependencyKey,i.rootTemplate),i.setDataSource=function(n,t){return function(i){f(n.datasource,null,n);y(i,t,n)}}(i,n),i.setDataSource(t),i.unbind=function(n){return function(t){f(n.datasource,null,n);_.isUndefined(t)||(t==="remove"?n.els.parentNode.removeChild(n.els):t==="reset"&&n.els.parentNode.replaceChild(n._backup,n.els))}}(i),i};return{options:n,bind:p,binders:i}}()})(this);
/*
//# sourceMappingURL=ezbuynd-0.3.min.js.map
*/